<!DOCTYPE html>
<html>
  <head>
    <title>Dashboard Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ccc;
      }
      button {
        margin: 5px;
        padding: 10px;
        background: #007bff;
        color: white;
        border: none;
        cursor: pointer;
      }
      button:hover {
        background: #0056b3;
      }
      .results {
        margin-top: 10px;
        padding: 10px;
        background: #f8f9fa;
      }
    </style>
  </head>
  <body>
    <h1>Dashboard Analytics Test</h1>

    <div class="test-section">
      <h3>1. Clear Data</h3>
      <button onclick="clearAllData()">Clear All Analytics Data</button>
      <div id="clear-result" class="results"></div>
    </div>

    <div class="test-section">
      <h3>2. Generate Test Data</h3>
      <button onclick="clearAndTest1Click()">
        Test: 1 Click (expect 100%)
      </button>
      <button onclick="clearAndTest2Clicks()">
        Test: 2 Clicks (expect 50%)
      </button>
      <button onclick="clearAndTest3Clicks()">
        Test: 3 Clicks (expect 33.3%)
      </button>
      <button onclick="testCategoryClick()">Click Fiction (1x)</button>
      <button onclick="testMultipleClicks()">
        Multiple Clicks (5x Fiction)
      </button>
      <div id="generate-result" class="results"></div>
    </div>

    <div class="test-section">
      <h3>3. Check Current Data</h3>
      <button onclick="checkCurrentData()">Check Analytics Data</button>
      <div id="data-result" class="results"></div>
    </div>

    <div class="test-section">
      <h3>4. Open Dashboard</h3>
      <button onclick="openDashboard()">Open Dashboard in New Tab</button>
      <p>
        Check if Category Navigation Clicks shows correct count and trend
        percentage
      </p>
    </div>

    <script type="module" src="scripts/shared/analytics.js"></script>
    <script src="scripts/shared/url-utils.js"></script>
    <script src="scripts/shared/shared-subheader-loader.js"></script>

    <script>
      function clearAllData() {
        localStorage.removeItem("product_discovery_data");
        document.getElementById("clear-result").innerHTML =
          "<strong>✓ All data cleared!</strong>";
      }

      function testCategoryClick() {
        if (window.analytics) {
          window.analytics.trackCategoryClick("Fiction");
          document.getElementById("generate-result").innerHTML =
            "<strong>✓ Fiction category click tracked!</strong>";
        } else {
          document.getElementById("generate-result").innerHTML =
            "<strong>✗ Analytics not available</strong>";
        }
      }

      function testMultipleClicks() {
        if (window.analytics) {
          for (let i = 0; i < 5; i++) {
            window.analytics.trackCategoryClick("Fiction");
          }
          document.getElementById("generate-result").innerHTML =
            "<strong>✓ 5 Fiction category clicks tracked!</strong>";
        } else {
          document.getElementById("generate-result").innerHTML =
            "<strong>✗ Analytics not available</strong>";
        }
      }

      function clearAndTest1Click() {
        clearAllData();
        setTimeout(() => {
          if (window.analytics) {
            window.analytics.trackCategoryClick("Fiction");
            document.getElementById("generate-result").innerHTML =
              "<strong>✓ 1 Fiction click - should show 100%</strong>";
          }
        }, 100);
      }

      function clearAndTest2Clicks() {
        clearAllData();
        setTimeout(() => {
          if (window.analytics) {
            window.analytics.trackCategoryClick("Fiction");
            window.analytics.trackCategoryClick("Fiction");
            document.getElementById("generate-result").innerHTML =
              "<strong>✓ 2 Fiction clicks - should show 50%</strong>";
          }
        }, 100);
      }

      function clearAndTest3Clicks() {
        clearAllData();
        setTimeout(() => {
          if (window.analytics) {
            window.analytics.trackCategoryClick("Fiction");
            window.analytics.trackCategoryClick("Fiction");
            window.analytics.trackCategoryClick("Fiction");
            document.getElementById("generate-result").innerHTML =
              "<strong>✓ 3 Fiction clicks - should show 33.3%</strong>";
          }
        }, 100);
      }

      function checkCurrentData() {
        const data = localStorage.getItem("product_discovery_data");
        if (data) {
          const parsed = JSON.parse(data);
          document.getElementById("data-result").innerHTML =
            "<strong>Current Data:</strong><br>" +
            `Category Clicks: ${parsed.categoryClicks || 0}<br>` +
            `Product Clicks: ${parsed.productClicks || 0}<br>` +
            `Search Queries: ${parsed.searchQueries || 0}<br>` +
            `Cart Additions: ${parsed.cartAdditions || 0}`;
        } else {
          document.getElementById("data-result").innerHTML =
            "<strong>No data found</strong>";
        }
      }

      function openDashboard() {
        window.open("dashboard.html", "_blank");
      }

      // Wait for analytics to load
      setTimeout(() => {
        if (window.analytics) {
          document.body.insertAdjacentHTML(
            "afterbegin",
            '<div style="background: #d4edda; padding: 10px; margin-bottom: 20px; border: 1px solid #c3e6cb; border-radius: 5px;">' +
              "<strong>✓ Analytics loaded successfully!</strong></div>"
          );
        } else {
          document.body.insertAdjacentHTML(
            "afterbegin",
            '<div style="background: #f8d7da; padding: 10px; margin-bottom: 20px; border: 1px solid #f5c6cb; border-radius: 5px;">' +
              "<strong>✗ Analytics failed to load</strong></div>"
          );
        }
      }, 1000);
    </script>
  </body>
</html>
