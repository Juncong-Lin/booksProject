<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Backend API Tester</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .test-section {
        margin-bottom: 30px;
        border: 1px solid #ddd;
        padding: 15px;
        border-radius: 5px;
      }
      .test-section h3 {
        margin-top: 0;
        color: #333;
      }
      .form-group {
        margin-bottom: 10px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      input,
      textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
      }
      button {
        background-color: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 10px;
      }
      button:hover {
        background-color: #0056b3;
      }
      .response {
        margin-top: 15px;
        padding: 10px;
        border-radius: 4px;
        white-space: pre-wrap;
        font-family: monospace;
        font-size: 12px;
      }
      .success {
        background-color: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
      }
      .error {
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
      }
      .status {
        font-weight: bold;
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ðŸš€ Backend API Tester</h1>
      <p>Test the bookstore backend API endpoints</p>

      <!-- Health Check -->
      <div class="test-section">
        <h3>1. Health Check</h3>
        <button onclick="testHealth()">Test Health Endpoint</button>
        <div id="healthResponse" class="response"></div>
      </div>

      <!-- User Signup -->
      <div class="test-section">
        <h3>2. User Signup</h3>
        <div class="form-group">
          <label>Name:</label>
          <input type="text" id="signupName" value="Test User" />
        </div>
        <div class="form-group">
          <label>Email:</label>
          <input type="email" id="signupEmail" value="test@example.com" />
        </div>
        <div class="form-group">
          <label>Password:</label>
          <input type="password" id="signupPassword" value="TestPass123" />
        </div>
        <div class="form-group">
          <label>Confirm Password:</label>
          <input
            type="password"
            id="signupConfirmPassword"
            value="TestPass123"
          />
        </div>
        <button onclick="testSignup()">Test Signup</button>
        <div id="signupResponse" class="response"></div>
      </div>

      <!-- User Login -->
      <div class="test-section">
        <h3>3. User Login</h3>
        <div class="form-group">
          <label>Email:</label>
          <input type="email" id="loginEmail" value="test@example.com" />
        </div>
        <div class="form-group">
          <label>Password:</label>
          <input type="password" id="loginPassword" value="TestPass123" />
        </div>
        <button onclick="testLogin()">Test Login</button>
        <div id="loginResponse" class="response"></div>
      </div>

      <!-- Get Profile -->
      <div class="test-section">
        <h3>4. Get User Profile</h3>
        <p>Note: Requires authentication token from login</p>
        <button onclick="testProfile()">Test Get Profile</button>
        <div id="profileResponse" class="response"></div>
      </div>

      <!-- Books Endpoint -->
      <div class="test-section">
        <h3>5. Get Books</h3>
        <button onclick="testBooks()">Test Get Books</button>
        <div id="booksResponse" class="response"></div>
      </div>
    </div>

    <script>
      const API_BASE = "http://localhost:5000/api/v1";
      let authToken = null;

      // Helper function to make API requests
      async function makeRequest(method, url, data = null, useAuth = false) {
        const options = {
          method: method,
          headers: {
            "Content-Type": "application/json",
          },
        };

        if (useAuth && authToken) {
          options.headers["Authorization"] = `Bearer ${authToken}`;
        }

        if (data) {
          options.body = JSON.stringify(data);
        }

        try {
          const response = await fetch(url, options);
          const responseData = await response.json();

          return {
            status: response.status,
            success: response.ok,
            data: responseData,
          };
        } catch (error) {
          return {
            status: 0,
            success: false,
            error: error.message,
          };
        }
      }

      // Display response in the UI
      function displayResponse(elementId, response) {
        const element = document.getElementById(elementId);
        const isSuccess =
          response.success && response.status >= 200 && response.status < 300;

        element.className = `response ${isSuccess ? "success" : "error"}`;

        let content = `Status: ${response.status}\n`;
        content += `Success: ${response.success}\n\n`;

        if (response.data) {
          content += JSON.stringify(response.data, null, 2);
        } else if (response.error) {
          content += `Error: ${response.error}`;
        }

        element.textContent = content;
      }

      // Test health endpoint
      async function testHealth() {
        const response = await makeRequest(
          "GET",
          "http://localhost:5000/health"
        );
        displayResponse("healthResponse", response);
      }

      // Test user signup
      async function testSignup() {
        const userData = {
          name: document.getElementById("signupName").value,
          email: document.getElementById("signupEmail").value,
          password: document.getElementById("signupPassword").value,
          confirmPassword: document.getElementById("signupConfirmPassword")
            .value,
        };

        const response = await makeRequest(
          "POST",
          `${API_BASE}/auth/signup`,
          userData
        );
        displayResponse("signupResponse", response);

        // Store auth token if signup successful
        if (
          response.success &&
          response.data &&
          response.data.data &&
          response.data.data.token
        ) {
          authToken = response.data.data.token;
          console.log("Auth token stored:", authToken);
        }
      }

      // Test user login
      async function testLogin() {
        const loginData = {
          email: document.getElementById("loginEmail").value,
          password: document.getElementById("loginPassword").value,
        };

        const response = await makeRequest(
          "POST",
          `${API_BASE}/auth/signin`,
          loginData
        );
        displayResponse("loginResponse", response);

        // Store auth token if login successful
        if (
          response.success &&
          response.data &&
          response.data.data &&
          response.data.data.token
        ) {
          authToken = response.data.data.token;
          console.log("Auth token stored:", authToken);
        }
      }

      // Test get profile
      async function testProfile() {
        if (!authToken) {
          displayResponse("profileResponse", {
            status: 401,
            success: false,
            data: { message: "No auth token available. Please login first." },
          });
          return;
        }

        const response = await makeRequest(
          "GET",
          `${API_BASE}/auth/me`,
          null,
          true
        );
        displayResponse("profileResponse", response);
      }

      // Test get books
      async function testBooks() {
        const response = await makeRequest("GET", `${API_BASE}/books`);
        displayResponse("booksResponse", response);
      }

      // Test health endpoint on page load
      window.addEventListener("load", () => {
        testHealth();
      });
    </script>
  </body>
</html>
