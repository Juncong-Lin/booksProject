<!DOCTYPE html>
<html>
  <head>
    <title>Product Discovery Analytics Dashboard - Juncongmall.com</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no"
    />

    <!-- Load fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />

    <!-- CSS files -->
    <link rel="stylesheet" href="styles/shared/general.css" />
    <link rel="stylesheet" href="styles/shared/qili-header.css" />
    <link rel="stylesheet" href="styles/shared/sub-header.css" />
    <link rel="stylesheet" href="styles/pages/dashboard.css" />
    <link rel="stylesheet" href="styles/shared/footer.css" />

    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

    <!-- Additional libraries for enhanced UI -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
  </head>

  <body class="no-sidebar dashboard-theme">
    <!-- Header -->
    <div id="shared-header-placeholder"></div>
    <div id="shared-subheader-placeholder"></div>

    <!-- Gradient Background -->
    <div class="dashboard-background">
      <div class="gradient-orb orb-1"></div>
      <div class="gradient-orb orb-2"></div>
      <div class="gradient-orb orb-3"></div>
    </div>

    <div class="main">
      <div class="dashboard-container animate__animated animate__fadeIn">
        <!-- Dashboard Header -->
        <div class="dashboard-header">
          <div class="header-content">
            <div class="title-section">
              <h1 class="dashboard-title">
                <i data-feather="shopping-bag" class="title-icon"></i>
                Product Discovery & Engagement Analytics
              </h1>
              <p class="dashboard-subtitle">
                Optimize product discovery and measure customer engagement on
                the homepage
              </p>
            </div>
            <div class="header-actions">
              <button class="action-btn refresh-btn" id="refresh-data">
                <i data-feather="refresh-cw"></i>
                <span>Refresh</span>
              </button>
              <button class="action-btn export-btn">
                <i data-feather="download"></i>
                <span>Export</span>
              </button>
              <a
                href="analytics-management.html"
                class="action-btn management-btn primary"
              >
                <i data-feather="settings"></i>
                <span>Manage Data</span>
              </a>
            </div>
          </div>

          <!-- Live Status Indicator -->
          <div class="live-status">
            <div class="status-indicator">
              <div class="status-dot"></div>
              <span>Live Data</span>
            </div>
            <div class="last-updated">
              Last updated: <span id="last-updated-time">Just now</span>
            </div>
          </div>
        </div>

        <!-- Summary Cards -->
        <div class="summary-cards">
          <div
            class="metric-card animate__animated animate__slideInUp"
            style="animation-delay: 0.1s"
          >
            <div class="card-header">
              <div class="card-icon page-views">
                <i data-feather="grid"></i>
              </div>
            </div>
            <div class="card-content">
              <h3>Category Navigation Clicks</h3>
              <div class="metric-value" id="category-clicks">0</div>
              <p class="metric-description">Book category interactions today</p>
            </div>
          </div>

          <div
            class="metric-card animate__animated animate__slideInUp"
            style="animation-delay: 0.2s"
          >
            <div class="card-header">
              <div class="card-icon unique-sessions">
                <i data-feather="book-open"></i>
              </div>
            </div>
            <div class="card-content">
              <h3>Product Card Clicks</h3>
              <div class="metric-value" id="product-clicks">0</div>
              <p class="metric-description">Individual product interest</p>
            </div>
          </div>

          <div
            class="metric-card animate__animated animate__slideInUp"
            style="animation-delay: 0.3s"
          >
            <div class="card-header">
              <div class="card-icon total-clicks">
                <i data-feather="search"></i>
              </div>
            </div>
            <div class="card-content">
              <h3>Search Queries</h3>
              <div class="metric-value" id="search-queries">0</div>
              <p class="metric-description">User search behavior patterns</p>
            </div>
          </div>

          <div
            class="metric-card animate__animated animate__slideInUp"
            style="animation-delay: 0.4s"
          >
            <div class="card-header">
              <div class="card-icon scroll-depth">
                <i data-feather="shopping-cart"></i>
              </div>
            </div>
            <div class="card-content">
              <h3>Add to Cart Rate</h3>
              <div class="metric-value" id="add-to-cart-rate">0.0%</div>
              <p class="metric-description">Purchase intent conversion</p>
            </div>
          </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-grid">
          <div
            class="chart-card animate__animated animate__slideInUp"
            style="animation-delay: 0.5s"
          >
            <div class="chart-header">
              <div class="chart-title">
                <h3>Category Click Patterns</h3>
                <p>Track which book categories are most popular over time</p>
              </div>
              <div class="chart-actions">
                <div class="time-filter">
                  <button class="filter-btn active" data-period="24h">
                    24H
                  </button>
                  <button class="filter-btn" data-period="7d">7D</button>
                  <button class="filter-btn" data-period="30d">30D</button>
                </div>
              </div>
            </div>
            <div class="chart-content">
              <canvas id="category-clicks-chart"></canvas>
            </div>
          </div>

          <div
            class="chart-card animate__animated animate__slideInUp"
            style="animation-delay: 0.6s"
          >
            <div class="chart-header">
              <div class="chart-title">
                <h3>Search Conversion Funnel</h3>
                <p>Track user journey from search query to purchase</p>
              </div>
              <div class="chart-controls">
                <div class="conversion-metric">
                  <span class="metric-label">Overall Conversion:</span>
                  <span class="metric-value" id="search-funnel-conversion-rate"
                    >0.0%</span
                  >
                </div>
              </div>
            </div>
            <div class="chart-content">
              <canvas id="search-conversion-chart"></canvas>
            </div>
          </div>

          <div
            class="chart-card animate__animated animate__slideInUp"
            style="animation-delay: 0.7s"
          >
            <div class="chart-header">
              <div class="chart-title">
                <h3>Popular Book Categories</h3>
                <p>Click distribution by book genres and subcategories</p>
              </div>
              <div class="chart-actions">
                <div class="category-summary">
                  <span class="total-categories">12 Categories</span>
                </div>
              </div>
            </div>
            <div class="chart-content-with-legend">
              <div
                class="chart-legend chart-legend-left"
                id="book-categories-legend-left"
              ></div>
              <div class="chart-content">
                <canvas id="book-categories-chart"></canvas>
              </div>
              <div
                class="chart-legend chart-legend-right"
                id="book-categories-legend-right"
              ></div>
            </div>
          </div>

          <div
            class="chart-card animate__animated animate__slideInUp"
            style="animation-delay: 0.8s"
          >
            <div class="chart-header">
              <div class="chart-title">
                <h3>Category Conversion Funnel</h3>
                <p>Track user journey from category view to purchase</p>
              </div>
              <div class="chart-controls">
                <div class="conversion-metric">
                  <span class="metric-label">Overall Conversion:</span>
                  <span class="metric-value" id="funnel-conversion-rate"
                    >0.0%</span
                  >
                </div>
              </div>
            </div>
            <div class="chart-content">
              <canvas id="category-funnel-chart"></canvas>
            </div>
          </div>
        </div>

        <!-- Conversion Funnel -->
        <div
          class="funnel-section animate__animated animate__slideInUp"
          style="animation-delay: 0.9s"
        >
          <div class="section-header">
            <div class="section-title">
              <h3>
                <i data-feather="trending-up"></i>
                Homepage to Purchase Journey
              </h3>
              <p>
                Track user conversion from homepage discovery to cart addition
              </p>
            </div>
            <div class="funnel-controls">
              <div class="conversion-rate">
                <span class="rate-label">Homepage Conversion Rate:</span>
                <span class="rate-value" id="homepage-conversion">0.0%</span>
              </div>
            </div>
          </div>

          <div class="funnel-visualization">
            <div class="funnel-step" data-step="homepage-visits">
              <div class="step-header">
                <div class="step-icon">
                  <i data-feather="home"></i>
                </div>
                <div class="step-info">
                  <div class="step-name">Homepage Visits</div>
                  <div class="step-description">
                    Visitors landing on homepage
                  </div>
                </div>
                <div class="step-metrics">
                  <div class="step-count" id="funnel-homepage">0</div>
                  <div class="step-percentage" id="funnel-homepage-percent">
                    0.0%
                  </div>
                </div>
              </div>
              <div class="step-bar-container">
                <div class="step-bar homepage" id="funnel-homepage-bar"></div>
              </div>
            </div>

            <div class="funnel-arrow">
              <i data-feather="chevron-down"></i>
            </div>

            <div class="funnel-step" data-step="category-clicks">
              <div class="step-header">
                <div class="step-icon">
                  <i data-feather="grid"></i>
                </div>
                <div class="step-info">
                  <div class="step-name">Category Navigation</div>
                  <div class="step-description">Users exploring categories</div>
                </div>
                <div class="step-metrics">
                  <div class="step-count" id="funnel-categories">0</div>
                  <div class="step-percentage" id="funnel-categories-percent">
                    0.0%
                  </div>
                </div>
              </div>
              <div class="step-bar-container">
                <div
                  class="step-bar categories"
                  id="funnel-categories-bar"
                ></div>
              </div>
            </div>

            <div class="funnel-arrow">
              <i data-feather="chevron-down"></i>
            </div>

            <div class="funnel-step" data-step="product-views">
              <div class="step-header">
                <div class="step-icon">
                  <i data-feather="book-open"></i>
                </div>
                <div class="step-info">
                  <div class="step-name">Product Views</div>
                  <div class="step-description">Individual product clicks</div>
                </div>
                <div class="step-metrics">
                  <div class="step-count" id="funnel-products">0</div>
                  <div class="step-percentage" id="funnel-products-percent">
                    0.0%
                  </div>
                </div>
              </div>
              <div class="step-bar-container">
                <div class="step-bar products" id="funnel-products-bar"></div>
              </div>
            </div>

            <div class="funnel-arrow">
              <i data-feather="chevron-down"></i>
            </div>

            <div class="funnel-step" data-step="add-to-cart">
              <div class="step-header">
                <div class="step-icon">
                  <i data-feather="shopping-cart"></i>
                </div>
                <div class="step-info">
                  <div class="step-name">Add to Cart</div>
                  <div class="step-description">Purchase intent actions</div>
                </div>
                <div class="step-metrics">
                  <div class="step-count" id="funnel-cart-adds">0</div>
                  <div class="step-percentage" id="funnel-cart-adds-percent">
                    0.0%
                  </div>
                </div>
              </div>
              <div class="step-bar-container">
                <div class="step-bar cart-adds" id="funnel-cart-adds-bar"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Real-time Events & Category Analysis Grid -->
        <div class="bottom-grid">
          <!-- Real-time Events -->
          <div
            class="realtime-section animate__animated animate__slideInUp"
            style="animation-delay: 1s"
          >
            <div class="section-header">
              <div class="section-title">
                <h3>
                  <div class="live-indicator">
                    <div class="live-dot"></div>
                    Live Product Discovery Events
                  </div>
                </h3>
                <p>
                  Real-time user interactions on homepage and product discovery
                </p>
              </div>
              <div class="realtime-controls">
                <button class="control-btn" id="pause-realtime">
                  <i data-feather="pause"></i>
                </button>
                <button class="control-btn" id="clear-events">
                  <i data-feather="trash-2"></i>
                </button>
              </div>
            </div>
            <div class="events-container">
              <div id="realtime-events" class="events-list">
                <!-- Events will be populated here -->
              </div>
            </div>
          </div>

          <!-- Category Performance Analysis -->
          <div
            class="category-analysis-section animate__animated animate__slideInUp"
            style="animation-delay: 1.1s"
          >
            <div class="section-header">
              <div class="section-title">
                <h3>
                  <i data-feather="bar-chart-2"></i>
                  Category Performance Analysis
                </h3>
                <p>
                  Deep dive into book category click patterns and conversion
                </p>
              </div>
              <div class="analysis-status">
                <span class="status-badge active">Live Analysis</span>
              </div>
            </div>

            <div class="category-overview">
              <div class="top-categories">
                <div class="category-rank">
                  <h4>Top Performing Categories</h4>
                  <div class="rank-list" id="top-categories-list">
                    <div class="rank-item">
                      <span class="rank-number">1</span>
                      <span class="category-name">Fiction</span>
                      <span class="click-count">1,247 clicks</span>
                    </div>
                    <div class="rank-item">
                      <span class="rank-number">2</span>
                      <span class="category-name">Romance</span>
                      <span class="click-count">892 clicks</span>
                    </div>
                    <div class="rank-item">
                      <span class="rank-number">3</span>
                      <span class="category-name">Mystery</span>
                      <span class="click-count">756 clicks</span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="conversion-metrics">
                <div class="metric-group">
                  <div class="metric">
                    <span class="metric-label">Category → Product CTR</span>
                    <span class="metric-value" id="category-product-ctr"
                      >0.0%</span
                    >
                  </div>
                  <div class="metric">
                    <span class="metric-label">Header vs Sidebar Usage</span>
                    <span class="metric-value" id="sidebar-header-usage"
                      >0.0% / 0.0%</span
                    >
                  </div>
                </div>
                <div class="metric-group">
                  <div class="metric">
                    <span class="metric-label">Search → Click Success</span>
                    <span class="metric-value" id="search-click-success"
                      >0.0%</span
                    >
                  </div>
                  <div class="metric">
                    <span class="metric-label">Avg Time to Click</span>
                    <span class="metric-value" id="avg-time-to-click"
                      >0.0s</span
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div id="shared-footer-placeholder"></div>

    <!-- Scripts -->
    <script src="config/config.js?v=2.0"></script>
    <script type="module" src="scripts/shared/analytics.js"></script>
    <script type="module" src="scripts/dashboard/dashboard.js"></script>
    <script src="scripts/shared/url-utils.js"></script>
    <script src="scripts/auth/auth.js"></script>
    <script src="scripts/shared/shared-header-loader.js"></script>
    <script src="scripts/shared/shared-subheader-loader.js"></script>
    <script src="scripts/shared/shared-footer-loader.js"></script>
    <script src="scripts/shared/sub-header-nav.js"></script>
    <script type="module" src="scripts/shared/search.js"></script>

    <!-- Initialize Feather Icons -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Delay feather icons initialization to reduce initial CPU load
        setTimeout(() => {
          feather.replace();
        }, 500);

        // Initialize search system
        if (window.searchSystem) {
          window.searchSystem.init();
        } else {
          // Try to import and initialize if not available globally
          import("./scripts/shared/search.js")
            .then((module) => {
              if (module.searchSystem) {
                module.searchSystem.init();
              }
            })
            .catch((error) => {
              console.log("Search system initialization failed:", error);
            });
        }

        // Add some interactive behaviors
        const refreshBtn = document.getElementById("refresh-data");
        if (refreshBtn) {
          refreshBtn.addEventListener("click", function () {
            this.classList.add("spinning");
            setTimeout(() => {
              this.classList.remove("spinning");
            }, 1000);
          });
        }

        // Update last updated time
        function updateTime() {
          const now = new Date();
          const timeString = now.toLocaleTimeString();
          const lastUpdated = document.getElementById("last-updated-time");
          if (lastUpdated) {
            lastUpdated.textContent = timeString;
          }
        }

        updateTime();
        setInterval(updateTime, 300000); // Update every 5 minutes to minimize CPU usage
      });
    </script>
  </body>
</html>
