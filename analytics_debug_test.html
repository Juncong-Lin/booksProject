<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analytics Debug Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .metric-display {
        display: flex;
        gap: 20px;
        margin: 15px 0;
      }
      .metric-card {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 3px;
        min-width: 150px;
      }
      .clear-btn {
        background: #ff4444;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 3px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h1>Analytics Debug Test</h1>

    <div class="test-section">
      <h2>Current Analytics Data</h2>
      <div class="metric-display">
        <div class="metric-card">
          <strong>Category Clicks:</strong>
          <div id="category-clicks">0</div>
        </div>
        <div class="metric-card">
          <strong>Header Clicks:</strong>
          <div id="header-clicks">0</div>
        </div>
        <div class="metric-card">
          <strong>Product Clicks:</strong>
          <div id="product-clicks">0</div>
        </div>
      </div>
      <button class="clear-btn" onclick="clearAnalytics()">
        Clear Analytics Data
      </button>
      <button onclick="refreshData()">Refresh Data</button>
    </div>

    <div class="test-section">
      <h2>Test Category Navigation</h2>
      <p>
        Click the buttons below and watch the analytics counters. Each click
        should increment the counter by exactly 1.
      </p>

      <!-- Simulate the actual subheader HTML structure -->
      <div id="shared-subheader-placeholder">
        <!-- This will be populated by the subheader loader -->
      </div>
    </div>

    <div class="test-section">
      <h2>Manual Test Buttons</h2>
      <button onclick="testCategoryClick()">Test trackCategoryClick()</button>
      <button onclick="testHeaderClick()">Test trackHeaderClick()</button>
    </div>

    <div class="test-section">
      <h2>Event Log</h2>
      <div
        id="event-log"
        style="
          height: 200px;
          overflow-y: auto;
          border: 1px solid #ccc;
          padding: 10px;
          background: #f9f9f9;
        "
      ></div>
    </div>

    <!-- Load required scripts -->
    <script src="scripts/shared/analytics.js"></script>
    <script src="scripts/shared/url-utils.js"></script>
    <script src="scripts/shared/shared-subheader-loader.js"></script>
    <script src="scripts/shared/sub-header-nav.js"></script>

    <script>
      // Initialize analytics
      window.analytics = new SimpleAnalytics();

      // Override console.log to capture analytics events
      const originalLog = console.log;
      console.log = function (...args) {
        originalLog.apply(console, args);

        // Capture analytics events
        const message = args.join(" ");
        if (
          message.includes("Tracked category click") ||
          message.includes("Tracked header click")
        ) {
          addToEventLog(message);
        }
      };

      function addToEventLog(message) {
        const log = document.getElementById("event-log");
        const timestamp = new Date().toLocaleTimeString();
        log.innerHTML += `<div>[${timestamp}] ${message}</div>`;
        log.scrollTop = log.scrollHeight;
      }

      function refreshData() {
        const data = JSON.parse(
          localStorage.getItem("product_discovery_data") || "{}"
        );
        document.getElementById("category-clicks").textContent =
          data.categoryClicks || 0;
        document.getElementById("header-clicks").textContent =
          data.headerClicks || 0;
        document.getElementById("product-clicks").textContent =
          data.productClicks || 0;
      }

      function clearAnalytics() {
        localStorage.removeItem("product_discovery_data");
        refreshData();
        document.getElementById("event-log").innerHTML = "";
        addToEventLog("Analytics data cleared");
      }

      function testCategoryClick() {
        window.analytics.trackCategoryClick("Test Category");
        refreshData();
      }

      function testHeaderClick() {
        window.analytics.trackHeaderClick("Test Header");
        refreshData();
      }

      // Load subheader and refresh data when page loads
      document.addEventListener("DOMContentLoaded", function () {
        loadSharedSubheader().then(() => {
          refreshData();
          addToEventLog("Page loaded, subheader initialized");
        });
      });

      // Refresh data every 2 seconds to catch any changes
      setInterval(refreshData, 2000);
    </script>
  </body>
</html>
